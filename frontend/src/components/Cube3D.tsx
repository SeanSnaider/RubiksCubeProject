import type { CubeState, Color } from '../types';

const COLOR_MAP: Record<Color, string> = {
  U: '#FFFFFF', // White
  D: '#FFFF00', // Yellow
  L: '#FFA500', // Orange
  R: '#FF0000', // Red
  F: '#00FF00', // Green
  B: '#0000FF', // Blue
};

// Each sticker is 4 corner points [x,y] — ported directly from Pygame draw.polygon() calls
// Organized as FACE_POLYGONS[face][row][col] = [[x,y], [x,y], [x,y], [x,y]]
type Point = [number, number];
type StickerPolygon = Point[];

const FACE_POLYGONS: Record<string, StickerPolygon[][]> = {
  // U face (White) - top of cube
  U: [
    [ // Row 0
      [[60,0], [168,0], [164,64], [48,64]],
      [[188,0], [296,0], [300,64], [184,64]],
      [[316,0], [424,0], [436,64], [320,64]],
    ],
    [ // Row 1
      [[44,76], [162,76], [156,152], [30,152]],
      [[184,76], [300,76], [304,150], [180,150]],
      [[322,76], [440,76], [452,152], [328,152]],
    ],
    [ // Row 2
      [[28,166], [156,166], [148,256], [10,256]],
      [[178,166], [306,166], [310,254], [174,254]],
      [[328,166], [456,166], [474,254], [336,254]],
    ],
  ],

  // D face (Yellow) - bottom, visible below front face
  D: [
    [ // Row 0 (closest to front face)
      [[94,270], [182,270], [178,336], [84,336]],
      [[198,270], [286,270], [290,336], [194,336]],
      [[302,268], [390,268], [398,336], [306,336]],
    ],
    [ // Row 1
      [[84,348], [178,348], [174,422], [76,422]],
      [[196,348], [288,348], [292,424], [192,424]],
      [[306,348], [400,348], [404,424], [310,424]],
    ],
    [ // Row 2 (farthest from front)
      [[74,438], [174,438], [170,522], [66,522]],
      [[192,438], [294,438], [298,522], [188,522]],
      [[310,436], [410,436], [414,524], [314,524]],
    ],
  ],

  // B face (Blue) - back, visible behind top face
  B: [
    [ // Row 0
      [[414,2], [314,2], [310,90], [410,90]],
      [[298,4], [188,4], [192,88], [292,88]],
      [[170,4], [66,4], [74,88], [174,88]],
    ],
    [ // Row 1
      [[404,102], [310,102], [306,178], [400,178]],
      [[292,102], [192,102], [196,178], [288,178]],
      [[174,104], [76,104], [84,178], [178,178]],
    ],
    [ // Row 2
      [[398,190], [306,190], [302,258], [390,258]],
      [[290,190], [194,190], [198,256], [286,256]],
      [[178,190], [84,190], [94,256], [182,256]],
    ],
  ],

  // L face (Orange) - left side
  L: [
    [ // Row 0
      [[52,158], [38,74], [50,12], [62,84]],
      [[20,162], [36,86], [48,164], [36,246]],
      [[0,264], [18,174], [34,264], [18,352]],
    ],
    [ // Row 1
      [[66,100], [56,166], [64,240], [74,164]],
      [[52,352], [62,264], [52,180], [38,264]],
      [[22,364], [36,440], [48,366], [36,282]],
    ],
    [ // Row 2
      [[80,354], [66,264], [76,180], [86,264]],
      [[56,362], [66,438], [74,360], [64,292]],
      [[40,454], [52,370], [62,442], [52,514]],
    ],
  ],

  // R face (Red) - right side
  R: [
    [ // Row 0
      [[484,264], [466,174], [450,264], [466,352]],
      [[464,162], [448,86], [436,164], [448,246]],
      [[432,158], [446,74], [434,12], [422,84]],
    ],
    [ // Row 1
      [[462,364], [448,440], [436,366], [446,282]],
      [[432,352], [422,264], [432,180], [446,264]],
      [[418,100], [428,166], [420,240], [410,164]],
    ],
    [ // Row 2
      [[444,454], [432,370], [422,442], [432,514]],
      [[428,362], [418,438], [410,360], [420,292]],
      [[404,354], [418,264], [408,180], [398,264]],
    ],
  ],

  // F face (Green) - front
  F: [
    [ // Row 0
      [[10,272], [148,272], [156,362], [28,362]],
      [[172,272], [312,272], [306,362], [178,362]],
      [[336,272], [474,272], [456,362], [328,362]],
    ],
    [ // Row 1
      [[32,376], [158,376], [164,450], [46,450]],
      [[180,376], [304,376], [300,450], [184,450]],
      [[328,376], [452,376], [438,450], [320,450]],
    ],
    [ // Row 2
      [[48,464], [164,464], [170,526], [62,526]],
      [[186,464], [298,464], [296,526], [188,526]],
      [[320,462], [436,462], [422,526], [314,526]],
    ],
  ],
};

// Render order matters for correct overlapping (painter's algorithm)
// Back faces first, front faces last — same order as original Pygame
const RENDER_ORDER: (keyof CubeState)[] = ['D', 'B', 'R', 'L', 'U', 'F'];

interface Cube3DProps {
  state: CubeState;
}

export function Cube3D({ state }: Cube3DProps) {
  return (
    <svg
      viewBox="0 0 484 530"
      style={{ width: '400px', height: '440px', display: 'block', margin: '0 auto' }}
    >
      {RENDER_ORDER.map((face) =>
        FACE_POLYGONS[face].map((row, r) =>
          row.map((points, c) => (
            <polygon
              key={`${face}-${r}-${c}`}
              points={points.map(([x, y]) => `${x},${y}`).join(' ')}
              fill={COLOR_MAP[state[face][r][c]]}
              strokeWidth="3"
            />
          ))
        )
      )}
    </svg>
  );
}
